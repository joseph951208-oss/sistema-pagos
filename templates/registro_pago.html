<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registrar Pago</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ðŸ’° Sistema de Pagos</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        {% if user_role in ['admin', 'supersu'] %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('upload_files') }}">Subir Archivos</a>
          </li>
        {% endif %}
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="{{ url_for('registro_pago') }}">Registrar Pago</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('registro_cliente') }}">Registrar Cliente</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('consulta') }}">Consulta de Pagos</a>
        </li>
      </ul>
      <span class="navbar-text me-3">
        Usuario: {{ session['username'] }}
      </span>
      <a class="btn btn-danger" href="{{ url_for('logout') }}">Cerrar sesiÃ³n</a>
    </div>
  </div>
</nav>

<div class="container mt-3">
    <h2>ðŸ’° Registrar Pago</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endwith %}

    <!-- Formulario de registro de pago directo -->
    <form method="POST" class="row g-3">
        <input type="hidden" name="accion" value="registrar_pago">

        <!-- Cliente con buscador -->
        <div class="col-md-6">
            <label for="cliente" class="form-label">Cliente</label>
            <input list="clientes" name="cliente" id="cliente" class="form-control" placeholder="Escriba el nombre o IP" required>
              <datalist id="clientes">
                {% for c in clientes %}
                    <option value="{{ c }}">
                {% endfor %}
</datalist>
        </div>

        <!-- Fecha -->
        <div class="col-md-3">
            <label for="fecha_pago" class="form-label">Fecha de Pago</label>
            <input type="date" name="fecha_pago" id="fecha_pago" class="form-control" required>
        </div>

        <!-- Forma de pago -->
        <div class="col-md-4">
            <label for="forma_pago" class="form-label">Forma de Pago</label>
            <select name="forma_pago" id="forma_pago" class="form-control" required onchange="toggleDocumento(this)">
                <option value="">Seleccione...</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
                <option value="Otros Bancos">Otros Bancos</option>
            </select>
        </div>

        <!-- Documento -->
        <div class="col-md-4 doc-num-div" style="display:none;">
            <label for="doc_num" class="form-label">Nro Documento</label>
            <input type="text" name="doc_num" id="doc_num" class="form-control">
        </div>

        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-success w-100">ðŸ’° Registrar Pago</button>
        </div>
    </form>
</div>

<script>
function toggleDocumento(select) {
    const docDiv = document.querySelector(".doc-num-div");
    const docInput = docDiv.querySelector("input");

    if (select.value === "Efectivo") {
        docDiv.style.display = "none";
        docInput.value = "";
        docInput.removeAttribute("required");
    } 
    else if (select.value === "Transferencia") {
        docDiv.style.display = "block";
        docInput.setAttribute("required", "required");
    } 
    else if (select.value === "Otros Bancos") {
        docDiv.style.display = "block";
        docInput.removeAttribute("required"); // visible pero sin validaciÃ³n obligatoria
    } 
    else {
        docDiv.style.display = "none";
        docInput.removeAttribute("required");
    }
}
</script>

</body>
</html>
